# Reference Audio Feature - User Flows

## Admin Flow: Upload Reference Audio

### Step 1: Admin Creates/Edits Script
```
Admin Dashboard â†’ Manage Scripts â†’ Add Script (or Edit Script)
```

### Step 2: Fill Script Details
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Add New Script                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Title: [Greetings]                 â”‚
â”‚ Language: [English]                â”‚
â”‚ Difficulty: [Beginner]             â”‚
â”‚ Tags: [greetings, basic]           â”‚
â”‚ Content: [Hello, how are you?]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 3: Add Reference Audio (NEW)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Reference Audio (Optional)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Upload audio for students to listen to before       â”‚
â”‚ recording their own pronunciation                    â”‚
â”‚                                                      â”‚
â”‚ [Upload Audio File] [Record Audio] [Clear Audio]   â”‚
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸµ Recorded Audio                              â”‚ â”‚
â”‚ â”‚ <audio player controls>                         â”‚ â”‚
â”‚ â”‚ Play | â‰¡ 00:15                                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 4: Save Script
```
[Cancel] [Create Script]
   â†“
Script saved with reference audio URL:
/uploads/reference-audio/referenceAudio-1234567890-123456789.webm
```

---

## Student Flow: Practice with Reference Audio

### Step 1: Select Script
```
Practice Page
  â†“
Scripts List (filtered by language/difficulty)
  â†“
Click Script: "Greetings"
```

### Step 2: See Reference Audio
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Greetings                                           â”‚
â”‚ English â€¢ Beginner                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ“¢ Listen to Reference Audio First           â”‚   â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚ â”‚ â”‚ <audio player>                          â”‚ â”‚   â”‚
â”‚ â”‚ â”‚ ğŸ”Š Volume: â•â•â•â•â•â•â•â•  00:00 / 00:15     â”‚ â”‚   â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚ â”‚ Listen to how the script should be            â”‚   â”‚
â”‚ â”‚ pronounced before recording                   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚           [ğŸ™ Start Recording]                     â”‚
â”‚                                                     â”‚
â”‚ Font Size: [A-] 16px [A+]                         â”‚
â”‚                                                     â”‚
â”‚ Script Text:                                       â”‚
â”‚ "Hello, how are you?"                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 3: Listen & Learn
- Student clicks play on reference audio
- Hears correct pronunciation
- Identifies key pronunciation points
- Pauses/rewinds as needed

### Step 4: Record Practice
- Student clicks "Start Recording"
- Records their own pronunciation
- Audio controls appear during recording
- Stops recording when done

### Step 5: Get Feedback & Correction Audio
```
Practice Results
â”œâ”€ Score: 85%
â”œâ”€ Accuracy: 90%
â”œâ”€ Duration: 0:15
â”‚
â”œâ”€ Pronunciation Analysis
â”‚ â”œâ”€ Hello: âœ“ Correct
â”‚ â”œâ”€ how: âœ“ Correct
â”‚ â”œâ”€ are: âœ“ Correct
â”‚ â””â”€ you: âœ“ Correct
â”‚
â””â”€ Feedback
  â””â”€ Great pronunciation! Keep practicing
```

Later, when admin reviews:
```
Admin Reviews â†’ Sends Correction Audio (if needed)

Student receives in Feedback page:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸµ Pronunciation Correction              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Listen to how your instructor            â”‚
â”‚ pronounces the text correctly to         â”‚
â”‚ improve your speaking                    â”‚
â”‚                                          â”‚
â”‚ [â–¶ Play Correction Audio] (0:15)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Feature Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ADMIN                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AdminScripts.tsx                                   â”‚
â”‚  â”œâ”€ Upload audio file                              â”‚
â”‚  â””â”€ Record audio from microphone                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ FormData (multipart)
               â”‚ POST /api/scripts
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BACKEND (Express)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  routes/scripts.ts                                  â”‚
â”‚  â”œâ”€ Multer: File upload handling                   â”‚
â”‚  â”œâ”€ Validate: Audio MIME type, <10MB              â”‚
â”‚  â””â”€ Store: /uploads/reference-audio/{filename}     â”‚
â”‚     Save URL in DB: referenceAudioURL              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Returns: {script with referenceAudioURL}
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DATABASE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Script Collection                                  â”‚
â”‚  {                                                  â”‚
â”‚    _id: ObjectId,                                  â”‚
â”‚    title: "Greetings",                             â”‚
â”‚    referenceAudioURL: "/uploads/reference-audio/...", â”‚
â”‚    ...                                              â”‚
â”‚  }                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ GET /api/scripts
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  STUDENT                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Practice.tsx                                       â”‚
â”‚  â”œâ”€ Display reference audio player                 â”‚
â”‚  â”œâ”€ Fetch audio from /uploads/reference-audio/...  â”‚
â”‚  â””â”€ <audio> HTML5 control                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Interactions

### 1. File Upload
```
Admin selects file â†’ File validated â†’ Sent with FormData â†’ 
Multer processes â†’ Stored in server â†’ URL saved in DB
```

### 2. Microphone Recording
```
Admin clicks "Record" â†’ getUserMedia permission â†’ 
Recording starts â†’ Blob collected â†’ Audio preview â†’ 
Ready to upload with form
```

### 3. Student Playback
```
Student clicks reference audio button â†’ 
Browser fetches from /uploads/reference-audio/{filename} â†’ 
HTML5 <audio> element plays â†’ Standard controls available
```

### 4. Correction Audio
```
Admin uploads correction (in Feedback page) â†’ 
Stored as referenceAudio field in Comment model â†’
Student sees "Pronunciation Correction" section â†’
Can play to hear corrected version
```

---

## Storage Locations

```
server/
â”œâ”€â”€ uploads/
â”‚   â”œâ”€â”€ reference-audio/              â† NEW: Reference audio files
â”‚   â”‚   â”œâ”€â”€ referenceAudio-1234567890-123456789.webm
â”‚   â”‚   â”œâ”€â”€ referenceAudio-1234567890-123456790.mp3
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ 8cd3a56ecff.../              â† Existing: Student recordings
â”‚       â”œâ”€â”€ recording-1234567890-123456789.webm
â”‚       â””â”€â”€ ...
```

Accessible via:
- `/uploads/reference-audio/referenceAudio-...` (web URL)
- `server/uploads/reference-audio/referenceAudio-...` (file path)

---

## User Experience Timeline

### Admin Perspective
```
T+0:00   Admin opens "Manage Scripts"
T+0:15   Admin clicks "Add Script"
T+0:30   Admin fills in script details (title, content, language, difficulty)
T+1:00   Admin clicks "Record Audio" OR "Upload Audio File"
T+1:30   Admin records/uploads reference audio
T+2:00   Admin sees preview of uploaded audio
T+2:15   Admin clicks "Create Script"
T+2:30   âœ“ Script created with reference audio
T+2:45   Admin receives success toast notification
```

### Student Perspective
```
T+0:00   Student clicks "Practice"
T+0:15   Student filters by language (English)
T+0:30   Student sees script list
T+0:45   Student clicks "Greetings" script
T+1:00   âœ“ Script page loads with reference audio player
T+1:15   Student plays reference audio
T+2:00   Student clicks "Start Recording"
T+2:15   Student records their pronunciation
T+3:00   Student clicks "Submit"
T+3:15   âœ“ Results show pronunciation analysis
T+3:30   Student reviews feedback
(Later)
T+N:00   Admin uploads correction audio
T+N:15   Student sees "Pronunciation Correction" in Feedback page
T+N:30   Student plays correction audio to learn
```

---

## File Size & Duration Examples

| File | Size | Duration | Format | Use Case |
|------|------|----------|--------|----------|
| Short word | 50KB | 0:05 | WebM | Single word example |
| Phrase | 150KB | 0:15 | MP3 | Short phrase |
| Sentence | 400KB | 0:30 | WAV | Full sentence |
| Paragraph | 1.5MB | 1:30 | MP3 | Extended text |
| Dialog | 3MB | 3:00 | WebM | Conversation example |

All files must be < 10MB to upload.

---

## Error Handling

```
Admin Actions â†’ Error Scenarios:

1. File Too Large
   User clicks Upload â†’ Selects 15MB file â†’ 
   âœ— Error: "File size must be less than 10MB"

2. Wrong File Type
   User clicks Upload â†’ Selects image file â†’
   âœ— Error: "Please select an audio file"

3. Microphone Permission Denied
   User clicks Record â†’ Browser permission prompt â†’ 
   User clicks "Deny" â†’
   âœ— Error: "Failed to access microphone"

4. Network Error During Upload
   User clicks Create â†’ Network drops â†’
   âœ— Error: "Failed to save script"
   Form remains filled with data for retry

All errors shown as red toast notifications with âŒ icon
```
